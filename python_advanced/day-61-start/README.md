61일차 목표: 고급 입력양식 만들기
어제는 플라스크 서버로 HTML 입력양식을 동작하도록 하여, 사용자가 양식에 입력한 데이터를 가져오는 방법을 봤습니다. 오늘은 여기서 더 나아가, 플라스크 확장 모듈 Flask-WTF를 사용하여 입력양식을 만들 거예요. Flask-WTF는 단순한 HTML 입력양식보다 장점이 많습니다. 예)

쉬운 유효성 검증 – 사용자가 필수 입력 항목에 올바른 형식으로 데이터를 입력했는지 검증합니다. 예) 사용자가 입력한 이메일 주소에 ‘@’과 ‘.’의 포함 여부 확인. 따라서 유효성 검증을 위한 코드를 직접 작성할 필요가 없습니다.

코드 라인 감소 – 웹사이트에 입력양식을 많이 사용한다면, 플라스크 입력양식 모듈을 사용하면 작성(혹은 복사 및 붙여넣기) 해야 하는 코드의 양을 획기적으로 줄일 수 있습니다.

CSRF 보호 기능 내장 - 사이트 간 요청 위조(Cross Site Request Forgery), 줄여서 CSRF는 모르는 사람에게 돈을 송금하는 등 사용자가 자신의 의지와는 무관한 행동을 하게 하는 공격이며, 이런 공격은 웹사이트의 보안을 해칩니다.

플라스크 개발자는 웹사이트의 입력양식을 만들 때 보통 Flask-WTF를 사용합니다. 하지만 실제로는 HTML 입력양식으로 만든 프로젝트도 있기 때문에 두 가지 방법의 동작원리를 이해하는 것이 중요합니다.



비밀
오늘 하루 동안, 비밀키가 있는 웹사이트를 만듭니다. 사용자 이름과 비밀번호를 정확하게 입력해야만 비밀키를 가진 페이지에 접근할 수 있습니다.


Flask-WTF 설치하기

WTForms라는 멋진 입력양식 라이브러리에 대해 많이 알아봤으니, 플라스크 앱에서 WTFomrs를 사용하여 입력양식을 만들고 작동해 봅시다.



시작 파일 다운로드
시작 파일을 다운로드하고, 파일의 압축을 푸세요. 시작 파일을 파이참에서 엽니다. 아래 화면과 같은 경고가 뜰 수 있으니, ‘필요사항 설치’를 클릭하여 플라스크를 설치하세요.




과제
login.html 파일을 렌더링 하는 로그인 경로를 생성하세요.

앱을 실행하여 동작을 확인합니다. 실행 시, 다음과 같이 나와야 합니다.


해답





플라스크 확장 모듈 Flask-WTF 설치

requirements.txt 파일에 필요한 라이브러리(프로젝트에 필요한 설치 패키지들)와 그 버전을 명시할 수 있습니다. 이렇게 하면 필요한 패키지를 포함하지 않고 프로젝트를 공유할 수 있으므로 프로젝트 파일의 크기가 훨씬 줄어듭니다. 여러분이 방금 시작 파일을 다운로드한 것처럼 누군가 여러분의 프로젝트를 다운로드했을 때, 코드 편집기에서 requirement.txt 파일에 있는 필요 패키지들을 설치하라고 합니다. 관련 내용은 여기를 참고하세요.



2. 터미널로 Flask-WTF를 설치하세요. 참고 문서: https://flask-wtf.readthedocs.io/en/1.0.x/install/


pip install Flask-WTF

*pip install은 대소문자를 구분합니다!

Resources for this lecture

Flask-WTF로 입력양식 만들기

과제: Flask-WTF 문서의 이 부분을 읽고, 간단한 로그인 양식을 만드는 방법을 알아보세요.



email과 password 항목은 반드시 있어야 합니다.

이 항목들은 StringFields로 만들면 됩니다.

validators에 대해 신경 쓰지 않아도 됩니다.

email과 password 입력창은 크기(너비)가 30이어야 합니다.

HTML로 <label>이나 <input> 요소를 직접 만들어서는 안 됩니다.

힌트: CSRF 보호 기능을 넣고 싶다면, login.html에 아래 코드를 추가해야 합니다.

{‌{ form.csrf_token }}
또, main.py에서 csrf_token을 생성하는 데 사용될 비밀키를 만들어야 합니다. 예)

app.secret_key = "some secret string"


그럼 다음과 같이 나와야 합니다.

해답:

https://gist.github.com/angelabauer/162f56578b9193090963a0691c826790

주의: 이 과제를 수행하려면 16일차 강의에서 다뤘던 파이썬의 클래스, 객체, 상속에 대해 잘 이해하고 있어야 합니다. 문서에 있는 코드를 이해하기 어렵다면 다시 복습해 보세요.







WTForms 코드 개선
코드 개선 사항
이전 강의의 해답 코드는 다음의 Flask-WTF 퀵스타트(Quickstart)로 만든 것입니다. 대부분의 학생들이 퀵스타트를 읽으면(그리고 60일간 파이썬을 배웠으면) 작성할 수 있는 코드라고 생각합니다. 하지만 WTForms 문서를 전부 읽으면, 코드를 개선할 수 있다는 것을 알 거예요.



1. WTForms의 PasswordField 입력창으로 password를 입력하면 텍스트를 가릴 수 있습니다.




여러 가지 입력창의 종류를 아래 WTFomrs 문서에서 확인해 보세요:

https://wtforms.readthedocs.io/en/2.3.x/fields/#basic-fields



2. StringField나 PasswordField를 만들 때 넣는 인자는 입력창의 label 프로퍼티입니다. 퀵스타트는 이 키워드 인자를 추가하지 않지만, 저는 인자의 종류가 명확하지 않을 때 키워드 인자를 자주 추가합니다.


아래는 form 객체가 전달될 때, login.html에서 label프로퍼티를 사용하는 방법입니다.




3. 입력양식의 action을 이미 설정하셨겠지만, 퀵스타트에서는 action을 정적 경로인 "/"로 설정합니다. 하지만 항상 다음과 같이 동적으로 생성되는 URL을 사용하는 것이 좋습니다.




4. 또한, WTForms으로 생성한 입력양식의 레이블과 입력창은 HTML 요소를 사용하여 레이아웃을 지정할 수 있습니다.

예)


그럼 다음과 같은 레이아웃이 됩니다.




5. 마지막으로, 1단계의 문서에서 SubmitField를 발견했나요? SubmitField로 제출 버튼을 바꿀 수 있습니다.





다섯 가지 개선사항을 반영하면 다음과 같은 코드가 됩니다.

https://gist.github.com/angelabauer/e5b1a26a79888f67b490c1f53ed2496c





Flask-WTF로 입력양식에 유효성 검사 추가하기
HTML 입력양식 대신 WTForms를 선택해야 하는 가장 큰 이유는 유효성 검증이 내장되어 있기 때문입니다. 이메일 주소는 ‘@’와 ‘.’을 반드시 포함해야 한다거나, 비밀번호는 최소 8자리여야 한다는 유효성 검증 코드를 직접 작성할 필요 없이, WTForms에서 바로 유효성 검증 규칙을 사용할 수 있습니다.



1. 입력양식의 입력창을 만들 때, validator 객체를 추가합니다. 예)

문서
validators 매개변수는 validator 객체의 리스트입니다. DataRequired를 지정한 두 입력창에는 데이터를 필수로 입력해야 하며, 사용자가 아무것도 입력하지 않을 시, 오류가 발생합니다.

입력양식이 제출된 후 오류가 많으면 errors 리스트가 생성되어, 오류를 발생시킨 필드의 프로퍼티로 HTML에 전달됩니다. 예)

form.<field>.errors



2. 오류가 발생 시, 반복문을 사용하여 이 오류들을 텍스트로 보여줄 수 있습니다.

문서




3. 마지막 단계는 사용자가 제출 버튼을 눌렀을 때 입력 값의 유효성을 검증하는 것입니다. 그러므로 기존 코드를 수정하여 POST 요청에 응답 후 데이터를 validate_on_submit()으로 검증할 수 있어야 합니다.




현재 입력양식을 테스트해 보면, 입력창을 공백으로 뒀을 때 팝업 알림이 뜨는 것을 볼 수 있습니다. 예) 크롬에서 테스트 시


이 동작은 WTForm의 유효성 검증이 아니라, 브라우저에 내장된 검증 방법으로 브라우저마다 다릅니다. 파이어폭스나 사파리 브라우저에서는 다르게 보일 거예요. 하지만 사용자가 인터넷 익스플로러를 사용한다면, 별도의 검증 방법이 없습니다.

4. 모든 사용자가 입력창의 유효성 검증을 받도록 입력양식에 novalidate라는 속성으로 브라우저 검증을 꺼야 합니다.


이제 유효성 검증을 위해 입력창을 빈칸으로 둔 채 ‘로그인’을 클릭하면 빨간색 경고가 나옵니다. 예)




과제: WTForm 유효성 검증에 관한 문서를 참고하여, 이메일 입력창에 Email 검증을 추가하여 ‘@’와 ‘.’이 있는 유효한 이메일을 입력하도록 하세요. 유효하지 않으면 오류가 발생합니다. 또, 비밀번호 입력창에 Length 검증을 추가하여 최소한 8자리를 입력하도록 하세요.



예) ‘@’ 없이 이메일 입력, 비밀번호를 4자리로 입력


힌트: 이메일 검증을 하기 위해 패키지를 추가로 설치해야 하는지 문서를 꼼꼼히 읽어보세요. 설치해야 한다면 pip install을 사용하여 터미널에서 패키지를 설치하세요.





WTForms로 폼 데이터 수신하기
기본 HTML 양식을 사용할 때 플라스크의 request 객체를 사용하여 POST 요청이 만들어질 때 폼에 입력된 키-값 쌍에 접근할 수 있다는 것을 확인했습니다.

WTForms를 사용하면 폼 데이터를 보다 쉽게 찾을 수 있으며, 그저 <form_object>.<form_field>.data를 이용하면 됩니다.

문서

예)


단, 필드 데이터를 인쇄하기 전에 폼이 제출된 것인지(POST 요청) 아니면 해당 폼이 렌더링될 때 GET 요청된 것인지 여부를 확인해야 합니다.

앞에서는 if request.method == "POST"를 사용했습니다



이번에는 간단하게 validate_on_submit() 의 반환 값을 확인해볼 텐데, 이 반환값은 사용자가 폼을 제출한 후 유효성 검증이 성공한 경우 True, 실패한 경우 False 가 됩니다.






도전 과제: 폼이 제출 및 검증되고, 크리덴셜이 다음과 일치하면

이메일: admin@email.com

비밀번호: 12345678

success.html 페이지가 표시되도록 하고, 일치하지 않을 경우 denied.html 페이지가 표시되도록 main.py의 /login경로를 업데이트해보세요.

예)


해답:

https://gist.github.com/angelabauer/20ba20298ee26c957f36176291de9d69





Jinja2로 템플릿 상속하기
앞서 우리는 진자를 사용하여 header.html 및 footer.html을 삽입할 수 있으며, 코드는 다음과 같을 수 있다는 것을 배웠습니다.

{% include "header.html" %}
웹 페이지 컨텐츠
{% include "footer.html" %}


이는 진자를 사용하여 웹 사이트를 템플릿화할 수 있는 매우 유연한 방법입니다. 즉, 헤더와 푸터가 동일하게 유지되면 모든 웹 페이지에 삽입할 수 있습니다.



템플릿 상속
그러나 실제로는 전체 웹 사이트에 동일한 디자인 템플릿을 사용하고 싶지만 헤더나 푸터의 일부 코드를 변경해야 하는 때도 있는데, 이 경우 템플릿 상속을 대신 사용하는 것이 좋습니다.

템플릿 상속은 클래스 상속과 유사해서 상위 템플릿을 가져와 하위 웹 페이지에서 스타일을 확장할 수 있습니다.



예를 들어 다음 코드가 포함된 base.html 파일을 생성하는 경우

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}{% endblock %}</title>
</head>
<body>
    {% block content %}{% endblock %}
</body>
</html>
이 템플릿을 상속하는 하위 웹 페이지에 의해 새 콘텐츠를 삽입할 수 있는 미리 정의된 영역(또는 블록)이 있습니다.



1. 다음과 같이 success.html 페이지를 재작성하여 이 base.html 템플릿으로부터 상속할 수 있습니다.

#1.
{% extends "base.html" %}
#2.
{% block title %}Success{% endblock %}
#3.
{% block content %}
   <div class="container">
      <h1>Top Secret </h1>
      <iframe src="https://giphy.com/embed/Ju7l5y9osyymQ" width="480" height="360" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>
      <p><a href="https://giphy.com/gifs/rick-astley-Ju7l5y9osyymQ">via GIPHY</a></p>
   </div>
{% endblock %}
#1. 코드의 라인1은 템플릿 엔진(진자)이 'base.html'을 이 페이지의 템플릿으로 사용하도록 명령합니다.

#2. 이 블록은 템플릿의 헤더에 사용자 정의된 제목을 삽입합니다.

#3. 이 블록은 웹 사이트의 콘텐츠를 제공하며, 해당 부분은 웹 페이지마다 달라집니다.



2. 도전 과제: denied.html에 대해 동일한 작업을 수행하여 base.html을 템플릿으로 사용하고 사용자 정의 제목과 콘텐츠가 들어갈 수 있도록 해보세요.

해답:

https://gist.github.com/angelabauer/aa7a7516bf02b1f0f1769dadaf4e6cf4



슈퍼 블록
파이썬 클래스로부터 상속받을 때 super.init()라는 구문을 자주 볼 수 있습니다.

super라는 키워드는 하위(자식) 클래스가 상속을 받게 되는 상위(부모) 클래스를 나타냅니다. 예를 들어 '심바'가 '무파사'에서 상속을 받은 경우 무파사가 super가 됩니다.


템플릿을 상속받을 때, 템플릿의 일부는 유지하되 일부는 추가하고 싶은 경우가 있는데, 이럴 때 슈퍼 블록을 사용할 수 있습니다.



3. base.html에 다음의 코드를 추가합니다.

<style>
{% block styling %}
body{
    background: purple;
}
{% endblock %}
</style>



저는 이 블록의 이름을 "styling"이라고 지었지만 여러분 원하는 이름으로 지정할 수도 있습니다.

단, {% endblock %}으로 모든 블록을 꼭 닫아주는 거 잊지 마세요

이제 웹 사이트를 새로고침 하면, 성공 페이지와 거부된 페이지 모두 배경이 보라색으로 표시되어야 합니다(인라인, 내부 및 외부 스타일 지정에 대해서는 본 과정의 43일차 CSS 섹션에서 다루었습니다).






이렇게 해서 동일한 템플릿을 사용하면 웹 사이트의 모든 웹 페이지를 얼마나 쉽게 수정할 수 있는지 알게 되었습니다. 그런데 만약 거부된 페이지에 <h1>도 빨간색으로 만들고 싶다면 어떻게 해야 할까요? 이 경우에는 <style> 태그의 내부 스타일 지정을 수정해야 하는데, 문제는 해당 코드가 base.html 템플릿에 있다는 겁니다. 하지만 다행스럽게도 우리에게는 슈퍼 블록이 있습니다.



4. denied.html 페이지에서 {‌{ super() }}를 사용하여 슈퍼 블록을 추가하면, 스타일링 블록의 모든 코드가 이 하위 페이지에 삽입됩니다. 그런 다음 {% endblock %}이전에 스타일을 추가하면 <h1>의 색상을 변경할 수 있습니다.



{% block styling %}
   {‌{ super() }}
   h1 {
      color:red;
   }
{% endblock %}



본 강의의 코드가 저장되어 있는 지스트(Gist):

https://gist.github.com/angelabauer/9842d06ca3b5c1c6668bef0f7f0601cb





플라스크 부트스트랩을 상속된 템플릿으로 사용하기
템플릿 상속에 대해 배운 이유가 있었어요! 바로 웹 사이트 디자인을 개선해야 하기 때문이죠. 지금 같아서는 90년대에 만들어진 사이트 같으니까요.




플라스크 부트스트랩
물론 58일 차에 배운 부트스트랩이라는 아주 유용한 도구를 사용하면 웹 사이트 외관을 신속하게 개선할 수 있습니다. 앞서 배웠듯이 웹 사이트 헤더에 부트스트랩 CSS 코드에 대한 링크를 포함시킬 수 있죠. 하지만 그보다 더 쉬운 방법이 있는데, 바로 플라스크 부트스트랩의 파이썬 확장 기능을 이용하는 겁니다.

1. pip를 사용하여 프로젝트에 플라스크 부트스트랩(Flask-Bootstrap)을 설치합니다.

pip install Flask-Bootstrap




2. 도전 과제: denied.html 파일에서 슈퍼 블록을 삭제하고, 부트스트랩을 템플릿으로 사용할 수 있도록 플라스크 부트스트랩 문서를 사용하여 denied.html, success.html, login.html, index.html로 변환해보세요.


과제 완료 시 다음과 같이 웹 사이트가 표시되어야 합니다:




WTForms를 지원하는 플라스크 부트스트랩
본 프로젝트에서 플라스크 부트스트랩을 사용하는 주된 이유는 WTForms로 폼을 만드는 가장 편리한 방법 중 하나이기 때문입니다.

{‌{ wtf.quick_form(form) }}를 사용하면 말 그대로 한 줄의 코드로 간단하게 폼을 만들 수 있습니다.



이 코드 라인은 템플릿에 상속된 WTForm 객체(form)를 가져옴으로써 폼에 대한 모든 레이블, 입력, 버튼, 스타일을 생성합니다.

전체 요소를 삭제하고, 부트스트랩으로부터 wtf 지원을 상속하기 위한 줄을 추가한 다음 quick_form()을 사용하기만 하면 간단하게 나만의 form을 생성할 수 있습니다.





코드를 실행하여 손쉽게 전체 폼을 확인하세요. 또한 유효성 검사를 통해 오류 메시지를 확인하는 것도 잊지 마세요!

관련 문서는 다음 링크에서 확인하실 수 있습니다.

https://pythonhosted.org/Flask-Bootstrap/forms.html



그렇다면 부트스트랩 quick_form()을 사용할 수 있는데 왜 번거롭게 기초부터 WTForm을 만드는 방법을 알려드렸는지 궁금하실 겁니다. 물론 잘 작동되기만 하면 모든 요소가 정말 멋지게 보일 수 있습니다. quick_form은 블랙박스와 같아요. 정말 마법같이 훌륭한 기능이죠. 그런데 폼이 깨지거나 기대했던 대로 되지 않으면 어떻게 할까요? 이 마법을 어떻게 디버깅할 건가요?

바로 그러한 경우에 대비하기 위해 이면의 작동 원리를 이해하는 것이 매우 중요합니다. 일단 원리를 이해한 다음에야 모든 지름길도 이용할 수 있는 거죠.



이 강의의 학습자료에서 완성된 프로젝트를 다운로드하실 수 있습니다.

Resources for this lecture
